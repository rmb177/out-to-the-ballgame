// Generated by CoffeeScript 1.3.1
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty;

  ottb.Map = (function() {

    Map.name = 'Map';

    function Map(selectLinkCallback) {
      this.setupSelectLinkListener = __bind(this.setupSelectLinkListener, this);
      this.map = new google.maps.Map(document.getElementById("schedule-map"), gMapOptions);
      this.gameMarkers = {};
      this.selectLinkCallback = selectLinkCallback;
      this.setupSelectLinkListener();
    }

    Map.prototype.addDatePicker = function(datePickerHtml) {
      return this.map.controls[google.maps.ControlPosition.TOP_CENTER].push(datePickerHtml);
    };

    Map.prototype.addItinerary = function(itineraryHtml) {
      return this.map.controls[google.maps.ControlPosition.TOP_RIGHT].push(itineraryHtml);
    };

    Map.prototype.displayGames = function(games) {
      var aMarker, game, gameId, lastInfoWindow, that, _i, _len, _ref, _results;
      that = this;
      _ref = that.gameMarkers;
      for (gameId in _ref) {
        if (!__hasProp.call(_ref, gameId)) continue;
        aMarker = _ref[gameId];
        aMarker.setMap(null);
      }
      lastInfoWindow = null;
      _results = [];
      for (_i = 0, _len = games.length; _i < _len; _i++) {
        game = games[_i];
        _results.push((function(game) {
          var context, marker, source, template;
          marker = new google.maps.Marker({
            position: new google.maps.LatLng(parseFloat(game.lat), parseFloat(game.lon)),
            title: game.away_team + ' @ ' + game.home_team,
            map: that.map
          });
          source = $("#info-window").html();
          template = Handlebars.compile(source);
          context = {
            game_id: game.id,
            away_team: game.away_team_abbr,
            home_team: game.home_team_abbr,
            game_time: game.game_time,
            displaySelectGameLink: true
          };
          google.maps.event.addListener(marker, 'click', function() {
            if (lastInfoWindow !== null) {
              lastInfoWindow.close();
            }
            lastInfoWindow = new google.maps.InfoWindow();
            lastInfoWindow.setContent(template(context));
            lastInfoWindow.open(that.map, marker);
            return false;
          });
          return that.gameMarkers[game.id] = marker;
        })(game));
      }
      return _results;
    };

    Map.prototype.setupSelectLinkListener = function() {
      var that;
      that = this;
      return $(document).on("click", ".select-game-link a", function(event) {
        that.selectLinkCallback(this.id);
        return false;
      });
    };

    return Map;

  })();

}).call(this);
